<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin â€“ Lyko Lake</title>
<style>
:root{--ceo:#ff3b30;--admin:#34c759;--bg:#0a4d4d;--accent:#22c5a4}
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
body{background:linear-gradient(135deg,var(--bg) 0%,#1a6b6b 50%,#0f3d3d 100%);color:#fff;min-height:100vh;padding:30px}
a.logo{font-size:1.8em;font-weight:bold;color:var(--accent);text-decoration:none;display:flex;align-items:center;gap:10px}
h1{font-size:2.5em;margin:20px 0 10px}
.users-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:25px;margin-top:30px}
.user-card{background:rgba(255,255,255,.05);border:2px solid rgba(34,197,164,.3);border-radius:15px;padding:20px;text-align:center;backdrop-filter:blur(10px);transition:transform .3s,box-shadow .3s;cursor:pointer;position:relative}
.user-card:hover{transform:translateY(-5px);box-shadow:0 10px 30px rgba(0,0,0,.4)}
.user-card img.avatar{width:80px;height:80px;border-radius:50%;object-fit:cover;margin:0 auto 12px;background:var(--accent)}
.user-card .display{font-size:1.3em;font-weight:600}
.user-card .username{color:rgba(255,255,255,.6);margin:4px 0}
.user-card .uid{font-size:.9em;color:rgba(255,255,255,.4)}
.rank{display:inline-block;padding:4px 10px;border-radius:999px;font-size:.75em;font-weight:600;margin-left:6px;position:relative}
.rank.ceo{background:var(--ceo);box-shadow:0 0 10px var(--ceo);animation:vibe .8s infinite alternate}
.rank.admin{background:var(--admin)}
.rank:hover .info-box{opacity:1;visibility:visible}
.info-box{position:absolute;top:-40px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.9);color:#fff;padding:6px 10px;border-radius:6px;font-size:.75em;white-space:nowrap;opacity:0;visibility:hidden;transition:opacity .2s;pointer-events:none}
.actions{margin-top:12px;display:flex;gap:8px;justify-content:center}
.actions button{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.3);color:#fff;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:.8em}
.actions button:hover{background:rgba(255,255,255,.2)}
.actions button:disabled{opacity:.4;cursor:not-allowed}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:1000}
.modal-content{background:#0a4d4d;border:2px solid var(--accent);border-radius:15px;padding:25px;width:90%;max-width:400px}
.modal h3{margin-bottom:15px}
.modal input,.modal select,.modal textarea{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:1px solid var(--accent);background:rgba(255,255,255,.05);color:#fff}
.modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:15px}
.hidden{display:none}
@keyframes vibe{to{transform:scale(1.05)}}
</style>
</head>
<body>
<a href="/" class="logo">ðŸŒŠ Lyko Lake</a>
<h1>Admin Panel</h1>
<div id="usersGrid" class="users-grid">Loading usersâ€¦</div>

<!-- generic modal -->
<div id="modal" class="modal hidden">
  <div class="modal-content">
    <h3 id="modalTitle"></h3>
    <div id="modalBody"></div>
    <div class="modal-actions">
      <button id="modalCancel">Cancel</button>
      <button id="modalConfirm">Confirm</button>
    </div>
  </div>
</div>

<script type="module">
import {initializeApp} from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import {getAuth,onAuthStateChanged} from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
import {getFirestore,collection,getDocs,doc,getDoc,updateDoc,setDoc,serverTimestamp} from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

/* ----------  your short-name config  ---------- */
const cfg={
  apiKey:"AIzaSyDUBeWvs6kOijqST6FVGirWs2EZ12aAAwU",
  authDomain:"lyko-lake.firebaseapp.com",
  projectId:"lyko-lake",
  storageBucket:"lyko-lake.firebasestorage.app",
  messagingSenderId:"685592614306",
  appId:"1:685592614306:web:b6a8f6f18407f9c0154efb"
};
const app=initializeApp(cfg);
const auth=getAuth(app);
const db=getFirestore(app);

/* ----------  rest of the file unchanged  ---------- */
const $=q=>document.querySelector(q);
const usersGrid=$('#usersGrid');
const modal=$('#modal'),modalTitle=$('#modalTitle'),modalBody=$('#modalBody'),
      modalCancel=$('#modalCancel'),modalConfirm=$('#modalConfirm');
let currentRow;
const hide=()=>modal.classList.add('hidden');
const show=(title,body)=>{
  modalTitle.textContent=title;
  modalBody.innerHTML=body;
  modal.classList.remove('hidden');
};
modalCancel.onclick=hide;
modalConfirm.onclick=()=>{hide(); currentRow.confirm?.();};

/* ----------  PERM CHECK  ---------- */
onAuthStateChanged(auth,async user=>{
  if(!user) return location.href='/auth.html';
  const me=(await getDoc(doc(db,'users',user.uid))).data();
  if(me?.rank!=='CEO') location.href='/404.html';
  else loadUsers();
});

/* ----------  LOAD USERS  ---------- */
async function loadUsers(){
  const snap=await getDocs(collection(db,'users'));
  usersGrid.innerHTML='';
  snap.forEach(d=>{
    const u=d.data(),card=document.createElement('div');
    card.className='user-card';
    card.innerHTML=`
      <img class="avatar" src="${u.avatar||'https://via.placeholder.com/80'}" alt="">
      <div class="display">${u.displayName}<span class="rank ${u.rank||''}">${u.rank||''}
        <span class="info-box">${u.rank==='CEO'?'CEO of Lyko Lake':'This Player is an Admin'}</span>
      </span></div>
      <div class="username">@${u.username}</div>
      <div class="uid">User #${u.uid}</div>
      <div class="actions">${actionButtons(u,d.id)}</div>`;
    card.onclick=e=>{
      if(e.target.tagName!=='BUTTON')window.open(`/profile.html?u=${u.username}`,'_blank');
    };
    usersGrid.appendChild(card);
  });
}

function actionButtons(u,uid){
  if(u.rank==='CEO')return'<i>immutable</i>';
  return`
    <button onclick="banUser('${uid}')">Ban</button>
    <button onclick="muteUser('${uid}')">Mute</button>
    <button onclick="renameUser('${uid}')">Rename</button>
    <button onclick="rankUser('${uid}')">Rank</button>`;
}

/* ----------  ACTIONS  ---------- */
window.banUser=async uid=>{
  const u=(await getDoc(doc(db,'users',uid))).data();
  const body=`
    <select id="banType">
      <option value="perm">Permanent</option>
      <option value="temp">Temporary</option>
    </select>
    <div id="tempOpts" class="hidden">
      <input id="banVal" type="number" min="1" value="1">
      <select id="banUnit">
        <option value="s">Seconds</option>
        <option value="m">Minutes</option>
        <option value="h">Hours</option>
        <option value="d">Days</option>
        <option value="y">Years</option>
      </select>
    </div>
    <textarea id="banReason" placeholder="Reason (visible to user)" rows="2"></textarea>`;
  show('Ban user',body);
  $('#banType').onchange=e=>$('#tempOpts').classList.toggle('hidden',e.target.value==='perm');
  currentRow.confirm=async()=>{
    const type=$('#banType').value,reason=$('#banReason').value.trim()||'No reason given';
    let until=null;
    if(type==='temp'){
      const n=Number($('#banVal').value),u=$('#banUnit').value;
      const ms={s:1000,m:60000,h:3600000,d:86400000,y:31536000000}[u];
      until=Date.now()+n*ms;
    }
    await setDoc(doc(db,'bans',uid),{until,reason,by:auth.currentUser.uid,at:serverTimestamp()});
    alert('User banned');loadUsers();
  };
};
window.muteUser=async uid=>{
  show('Mute user','<textarea id="muteReason" placeholder="Reason (internal)" rows="2"></textarea>');
  currentRow.confirm=async()=>{
    await updateDoc(doc(db,'users',uid),{muted:true});
    alert('User muted');loadUsers();
  };
};
window.renameUser=async uid=>{
  const u=(await getDoc(doc(db,'users',uid))).data();
  const body=`New display name:<br><input id="newName" value="${u.displayName}" maxlength="30">`;
  show('Rename user',body);
  currentRow.confirm=async()=>{
    const name=$('#newName').value.trim();
    if(!name)return alert('Name required');
    await updateDoc(doc(db,'users',uid),{displayName:name});
    alert('Name updated');loadUsers();
  };
};
window.rankUser=async uid=>{
  const u=(await getDoc(doc(db,'users',uid))).data();
  const body=`
    <select id="rankSel">
      <option value="Member">Member</option>
      <option value="Admin">Admin</option>
    </select>`;
  show('Change rank',body);
  $('#rankSel').value=u.rank||'Member';
  currentRow.confirm=async()=>{
    const rank=$('#rankSel').value;
    await updateDoc(doc(db,'users',uid),{rank});
    alert('Rank updated');loadUsers();
  };
};
</script>
